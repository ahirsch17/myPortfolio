<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Smart Workout Tracker</title>

  <style>

    * {

      margin: 0;

      padding: 0;

      box-sizing: border-box;

    }



    :root {

      color-scheme: dark;

      --sky-400: #38bdf8;

      --sky-500: #0ea5e9;

      --emerald-400: #34d399;

      --emerald-500: #10b981;

      --orange-400: #fb923c;

      --orange-500: #f97316;

      --purple-400: #a78bfa;

      --purple-500: #8b5cf6;

      --slate-300: #cbd5e1;

      --slate-400: #94a3b8;

      --slate-500: #64748b;

      --slate-700: #334155;

      --slate-800: #1e293b;

      --slate-900: #0f172a;

      --white: #ffffff;

    }



    body {

      background: radial-gradient(circle at 50% -20%, rgba(37,99,235,0.35), rgba(15,23,42,0.92));

      min-height: 100vh;

      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

      color: var(--slate-300);

      line-height: 1.5;

    }



    .glass {

      background: rgba(15, 23, 42, 0.75);

      backdrop-filter: blur(18px);

      border: 1px solid rgba(148, 163, 184, 0.22);

    }



    .rounded-2xl { border-radius: 1rem; }

    .rounded-3xl { border-radius: 1.5rem; }

    .rounded-full { border-radius: 9999px; }



    .text-xs { font-size: 0.75rem; }

    .text-sm { font-size: 0.875rem; }

    .text-lg { font-size: 1.125rem; }

    .text-xl { font-size: 1.25rem; }

    .text-2xl { font-size: 1.5rem; }

    .text-3xl { font-size: 1.875rem; }

    .text-4xl { font-size: 2.25rem; }



    .font-medium { font-weight: 500; }

    .font-semibold { font-weight: 600; }

    .font-bold { font-weight: 700; }



    .flex { display: flex; }

    .grid { display: grid; }

    .hidden { display: none; }

    .items-center { align-items: center; }

    .items-end { align-items: flex-end; }

    .justify-center { justify-content: center; }

    .justify-between { justify-content: space-between; }

    .justify-start { justify-content: flex-start; }



    .gap-2 { gap: 0.5rem; }

    .gap-3 { gap: 0.75rem; }

    .gap-4 { gap: 1rem; }

    .gap-6 { gap: 1.5rem; }



    .space-y-2 > * + * { margin-top: 0.5rem; }

    .space-y-3 > * + * { margin-top: 0.75rem; }

    .space-y-4 > * + * { margin-top: 1rem; }

    .space-y-6 > * + * { margin-top: 1.5rem; }



    .p-3 { padding: 0.75rem; }

    .p-4 { padding: 1rem; }

    .p-5 { padding: 1.25rem; }

    .p-6 { padding: 1.5rem; }

    .p-8 { padding: 2rem; }

    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }

    .px-4 { padding-left: 1rem; padding-right: 1rem; }

    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }

    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }

    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }

    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }



    .mb-2 { margin-bottom: 0.5rem; }

    .mb-3 { margin-bottom: 0.75rem; }

    .mb-4 { margin-bottom: 1rem; }

    .mb-6 { margin-bottom: 1.5rem; }

    .mt-2 { margin-top: 0.5rem; }

    .mt-4 { margin-top: 1rem; }

    .mt-6 { margin-top: 1.5rem; }



    .w-full { width: 100%; }

    .w-12 { width: 3rem; }

    .w-16 { width: 4rem; }

    .w-20 { width: 5rem; }

    .h-12 { height: 3rem; }

    .h-16 { height: 4rem; }

    .h-20 { height: 5rem; }

    .min-h-screen { min-height: 100vh; }



    .text-center { text-align: center; }

    .text-white { color: var(--white); }

    .text-sky-400 { color: var(--sky-400); }

    .text-orange-400 { color: var(--orange-400); }

    .text-emerald-400 { color: var(--emerald-400); }

    .text-purple-400 { color: var(--purple-400); }

    .text-slate-300 { color: var(--slate-300); }

    .text-slate-400 { color: var(--slate-400); }



    .bg-sky-500 { background-color: var(--sky-500); }

    .bg-emerald-500 { background-color: var(--emerald-500); }

    .bg-orange-500 { background-color: var(--orange-500); }

    .bg-purple-500 { background-color: var(--purple-500); }

    .bg-slate-700 { background-color: var(--slate-700); }

    .bg-slate-800 { background-color: var(--slate-800); }

    .bg-slate-800-50 { background-color: rgba(30, 41, 59, 0.5); }

    .bg-sky-500-20 { background-color: rgba(14, 165, 233, 0.2); }

    .bg-emerald-500-20 { background-color: rgba(16, 185, 129, 0.2); }

    .bg-orange-500-20 { background-color: rgba(249, 115, 22, 0.2); }

    .bg-purple-500-20 { background-color: rgba(139, 92, 246, 0.2); }



    .border { border-width: 1px; }

    .border-slate-700 { border-color: var(--slate-700); }

    .border-emerald-500 { border-color: var(--emerald-500); }

    .border-sky-500 { border-color: var(--sky-500); }



    .cursor-pointer { cursor: pointer; }

    .transition-all { transition: all 0.3s ease; }



    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }

    .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

    .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }



    .col-span-2 { grid-column: span 2 / span 2; }



    .relative { position: relative; }

    .absolute { position: absolute; }

    .fixed { position: fixed; }

    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }

    .bottom-6 { bottom: 1.5rem; }

    .right-6 { right: 1.5rem; }

    .z-50 { z-index: 50; }

    .mx-auto { margin-left: auto; margin-right: auto; }



    .max-w-md { max-width: 28rem; }

    .max-w-2xl { max-width: 42rem; }

    .max-h-\[90vh\] { max-height: 90vh; }



    .overflow-y-auto { overflow-y: auto; }

    .overflow-x-auto { overflow-x: auto; }



    @keyframes kpiPulse {

      0%, 100% { 

        box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.45); 

      }

      50% { 

        box-shadow: 0 0 0 18px rgba(74, 222, 128, 0); 

      }

    }



    .kpi-pulse {

      animation: kpiPulse 2s infinite;

    }



    .loading-spinner {

      border: 3px solid rgba(148, 163, 184, 0.3);

      border-radius: 50%;

      border-top: 3px solid var(--sky-400);

      width: 40px;

      height: 40px;

      animation: spin 1s linear infinite;

    }



    @keyframes spin {

      0% { transform: rotate(0deg); }

      100% { transform: rotate(360deg); }

    }



    button {

      background: rgba(15, 23, 42, 0.75);

      border: 1px solid rgba(148, 163, 184, 0.22);

      border-radius: 1rem;

      color: var(--slate-300);

      padding: 1rem 1.5rem;

      cursor: pointer;

      outline: none;

      transition: all 0.3s ease;

      font-size: 1rem;

      font-weight: 600;

    }



    button:hover {

      background: rgba(255, 255, 255, 0.1);

      transform: translateY(-2px);

    }



    button.primary {

      background: var(--sky-500);

      color: white;

      border: none;

    }



    button.primary:hover {

      background: var(--sky-400);

      transform: translateY(-2px);

    }



    select {

      background: rgba(15, 23, 42, 0.75);

      border: 1px solid var(--slate-700);

      border-radius: 0.5rem;

      color: var(--slate-300);

      padding: 0.5rem;

      cursor: pointer;

      outline: none;

    }



    .workout-card {

      transition: all 0.3s ease;

      cursor: pointer;

    }



    .workout-card:hover {

      transform: translateY(-4px);

      border-color: var(--sky-400);

    }



    .workout-card.selected {

      border-color: var(--emerald-500);

      background: rgba(16, 185, 129, 0.1);

    }



    .intensity-btn {

      padding: 0.75rem 1.5rem;

      border-radius: 2rem;

      border: 2px solid var(--slate-700);

      background: transparent;

      color: var(--slate-300);

      transition: all 0.3s ease;

    }



    .intensity-btn.selected {

      border-color: var(--sky-500);

      background: var(--sky-500);

      color: white;

    }



    .intensity-btn.easy { border-color: var(--emerald-500); }

    .intensity-btn.medium { border-color: var(--orange-500); }

    .intensity-btn.hard { border-color: #ef4444; }



    .intensity-btn.easy.selected { background: var(--emerald-500); }

    .intensity-btn.medium.selected { background: var(--orange-500); }

    .intensity-btn.hard.selected { background: #ef4444; }



    .progress-bar {

      width: 100%;

      height: 8px;

      background: var(--slate-700);

      border-radius: 4px;

      overflow: hidden;

    }



    .progress-fill {

      height: 100%;

      background: var(--emerald-500);

      transition: width 0.3s ease;

    }



    .exercise-group {

      border-left: 3px solid var(--slate-700);

      padding-left: 1rem;

      margin-left: 0.5rem;

    }



    .exercise-item {

      padding: 0.75rem;

      border-radius: 0.75rem;

      background: rgba(30, 41, 59, 0.3);

      margin-bottom: 0.5rem;

      cursor: pointer;

      transition: all 0.2s ease;

    }



    .exercise-item:hover {

      background: rgba(30, 41, 59, 0.5);

    }



    .exercise-item.selected {

      background: rgba(14, 165, 233, 0.2);

      border: 1px solid var(--sky-500);

    }



    .effort-badge {

      padding: 0.25rem 0.75rem;

      border-radius: 1rem;

      font-size: 0.75rem;

      font-weight: 600;

    }



    .effort-low { background: var(--emerald-500); color: white; }

    .effort-medium { background: var(--orange-500); color: white; }

    .effort-high { background: #ef4444; color: white; }



    .workout-session {

      border-left: 4px solid var(--sky-500);

      padding: 1rem;

      margin-bottom: 1rem;

      background: rgba(30, 41, 59, 0.3);

    }



    @media (min-width: 768px) {

      .md\\:p-6 { padding: 1.5rem; }

      .md\\:text-3xl { font-size: 1.875rem; }

      .md\\:flex-row { flex-direction: row; }

      .md\\:items-center { align-items: center; }

      .md\\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

      .md\\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }

    }



    @media (min-width: 1024px) {

      .lg\\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

      .lg\\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }

    }

  </style>

</head>

<body>

  <div id="root">
    <!-- Content will be rendered here immediately -->
  </div>



  <script>

    function initializeApp() {

      // Utility functions

      const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

      

      const computeZone = (hr) => {

        if (hr < 100) return { zone: 1, weight: 0.2 };

        if (hr < 120) return { zone: 2, weight: 0.4 };

        if (hr < 140) return { zone: 3, weight: 0.7 };

        if (hr < 160) return { zone: 4, weight: 1.0 };

        return { zone: 5, weight: 1.3 };

      };

      

      const computeEffort = (hr, acc, workoutType) => {

        const { weight } = computeZone(hr);

        const movementFactor = clamp(0.2 + 0.25 * acc, 0.0, 1.2);

        

        let hrWeight = weight;

        let movementWeight = movementFactor;

        

        // Adjust weights based on workout type

        if (workoutType === 'cardio') {

          hrWeight *= 1.15;

          movementWeight *= 0.9;

        } else if (workoutType === 'strength') {

          movementWeight *= 1.15;

          hrWeight *= 0.9;

        } else if (workoutType === 'isometric') {

          // Isometric exercises: lower movement factor, maintain HR weighting

          movementWeight *= 0.8;

          hrWeight *= 1.1;

        }

        

        return clamp(hrWeight * movementWeight * 100, 0, 100);

      };

      

      const formatDuration = (seconds) => {

        const mins = Math.floor(seconds / 60);

        const secs = seconds % 60;

        return `${mins}:${secs.toString().padStart(2, '0')}`;

      };



      const getEffortLevel = (score) => {

        if (score < 30) return { level: 'Low', description: 'Light activity - great for recovery days', color: 'effort-low' };

        if (score < 60) return { level: 'Medium', description: 'Moderate effort - ideal for consistent training', color: 'effort-medium' };

        return { level: 'High', description: 'High intensity - excellent for pushing limits', color: 'effort-high' };

      };



      // Application state

      const state = {

        currentView: 'dashboard', // 'dashboard', 'logWorkout', 'activeWorkout', 'history'

        selectedExercises: [],

        workoutSessions: [],

        currentSession: null

      };



      // Exercise database with subgroups

      const exercises = {

        cardio: {

          name: "Cardio",

          icon: "üèÉ",

          exercises: {

            running: { name: "Running", baseHR: 140, baseAcc: 0.8, type: "cardio" },

            cycling: { name: "Cycling", baseHR: 130, baseAcc: 0.6, type: "cardio" },

            rowing: { name: "Rowing", baseHR: 135, baseAcc: 1.1, type: "cardio" },

            swimming: { name: "Swimming", baseHR: 130, baseAcc: 0.7, type: "cardio" },

            jumpRope: { name: "Jump Rope", baseHR: 150, baseAcc: 1.4, type: "cardio" }

          }

        },

        upperBody: {

          name: "Upper Body",

          icon: "üí™", 

          exercises: {

            benchPress: { name: "Bench Press", baseHR: 110, baseAcc: 1.3, type: "strength" },

            shoulderPress: { name: "Shoulder Press", baseHR: 105, baseAcc: 1.1, type: "strength" },

            bicepCurls: { name: "Bicep Curls", baseHR: 95, baseAcc: 0.8, type: "strength" },

            tricepExtensions: { name: "Tricep Extensions", baseHR: 98, baseAcc: 0.9, type: "strength" },

            pullUps: { name: "Pull-ups", baseHR: 115, baseAcc: 1.2, type: "strength" },

            seatedRow: { name: "Seated Row", baseHR: 115, baseAcc: 1.3, type: "strength" },

            chestFly: { name: "Chest Fly", baseHR: 105, baseAcc: 1.0, type: "strength" }

          }

        },

        lowerBody: {

          name: "Lower Body",

          icon: "ü¶µ",

          exercises: {

            squats: { name: "Squats", baseHR: 120, baseAcc: 1.6, type: "strength" },

            deadlifts: { name: "Deadlifts", baseHR: 125, baseAcc: 1.8, type: "strength" },

            lunges: { name: "Lunges", baseHR: 110, baseAcc: 1.2, type: "strength" },

            legPress: { name: "Leg Press", baseHR: 115, baseAcc: 1.4, type: "strength" },

            calfRaises: { name: "Calf Raises", baseHR: 90, baseAcc: 0.7, type: "strength" },

            hipThrust: { name: "Hip Thrust", baseHR: 115, baseAcc: 1.4, type: "strength" }

          }

        },

        core: {

          name: "Core",

          icon: "üéØ",

          exercises: {

            planks: { name: "Planks", baseHR: 100, baseAcc: 0.5, type: "isometric" },

            crunches: { name: "Crunches", baseHR: 102, baseAcc: 0.6, type: "strength" },

            russianTwists: { name: "Russian Twists", baseHR: 105, baseAcc: 0.8, type: "strength" },

            legRaises: { name: "Leg Raises", baseHR: 98, baseAcc: 0.7, type: "strength" },

            mountainClimbers: { name: "Mountain Climbers", baseHR: 125, baseAcc: 1.3, type: "cardio" },

            sidePlank: { name: "Side Plank", baseHR: 100, baseAcc: 0.4, type: "isometric" }

          }

        },

        flexibility: {

          name: "Flexibility",

          icon: "üßò",

          exercises: {

            yoga: { name: "Yoga Flow", baseHR: 90, baseAcc: 0.3, type: "mixed" },

            stretching: { name: "Stretching", baseHR: 85, baseAcc: 0.2, type: "mixed" },

            pilates: { name: "Pilates", baseHR: 100, baseAcc: 0.6, type: "mixed" }

          }

        }

      };



      // Workout templates

      const workoutTemplates = {

        pushDay: {

          name: "Push Day",

          exercises: ['benchPress', 'shoulderPress', 'tricepExtensions', 'mountainClimbers']

        },

        pullDay: {

          name: "Pull Day", 

          exercises: ['pullUps', 'bicepCurls']

        },

        legDay: {

          name: "Leg Day",

          exercises: ['squats', 'deadlifts', 'lunges', 'calfRaises']

        },

        fullBody: {

          name: "Full Body",

          exercises: ['squats', 'benchPress', 'pullUps', 'planks', 'running']

        },

        cardioDay: {

          name: "Cardio Focus",

          exercises: ['running', 'cycling', 'jumpRope', 'mountainClimbers']

        }

      };



      // Intensity multipliers by exercise type

      // Strength exercises: Proximity to failure (Reps in Reserve/RIR)
      const strengthIntensityMultipliers = {

        '4RepsFromFailure': { hr: 0.75, acc: 0.7, label: '4 Reps From Failure' },

        '2RepsFromFailure': { hr: 1.0, acc: 1.0, label: '2 Reps From Failure' },

        'toFailure': { hr: 1.4, acc: 1.5, label: 'To Failure' }

      };

      // Cardio exercises: Easy / Moderate / Hard
      const cardioIntensityMultipliers = {

        'easy': { hr: 0.75, acc: 0.7, label: 'Easy' },

        'moderate': { hr: 1.0, acc: 1.0, label: 'Moderate' },

        'hard': { hr: 1.3, acc: 1.4, label: 'Hard' }

      };

      // Isometric exercises: Hold difficulty
      const isometricIntensityMultipliers = {

        'steadyHold': { hr: 0.8, acc: 0.5, label: 'Steady Hold' },

        'challengingHold': { hr: 1.0, acc: 0.6, label: 'Challenging Hold' },

        'maxEffortHold': { hr: 1.3, acc: 0.7, label: 'Max Effort Hold' }

      };

      // Helper function to get intensity multiplier based on exercise type
      function getIntensityMultiplier(exerciseType, intensityKey) {

        if (exerciseType === 'strength') {

          return strengthIntensityMultipliers[intensityKey] || strengthIntensityMultipliers['2RepsFromFailure'];

        } else if (exerciseType === 'cardio') {

          return cardioIntensityMultipliers[intensityKey] || cardioIntensityMultipliers['moderate'];

        } else if (exerciseType === 'isometric') {

          return isometricIntensityMultipliers[intensityKey] || isometricIntensityMultipliers['challengingHold'];

        } else if (exerciseType === 'mixed') {

          // Mixed exercises use cardio-style intensity
          return cardioIntensityMultipliers[intensityKey] || cardioIntensityMultipliers['moderate'];

        }

        // Default fallback
        return strengthIntensityMultipliers['2RepsFromFailure'];

      }

      // Helper function to get default duration (in seconds) based on exercise type
      function getDefaultDuration(exerciseType) {

        if (exerciseType === 'strength') {

          return 120; // 2 minutes of active work (multiple sets)

        } else if (exerciseType === 'cardio') {

          return 300; // 5 minutes of continuous work

        } else if (exerciseType === 'isometric') {

          return 90; // 1.5 minutes (1-2 minutes range)

        } else if (exerciseType === 'mixed') {

          return 210; // 3.5 minutes (3-4 minutes range)

        }

        return 120; // Default fallback

      }

      // Helper function to get default intensity based on exercise type
      function getDefaultIntensity(exerciseType) {

        if (exerciseType === 'strength') {

          return '2RepsFromFailure';

        } else if (exerciseType === 'cardio') {

          return 'moderate';

        } else if (exerciseType === 'isometric') {

          return 'challengingHold';

        } else if (exerciseType === 'mixed') {

          return 'moderate';

        }

        return '2RepsFromFailure'; // Default fallback

      }



      // Internal state for active workout

      let activeWorkoutData = [];

      let workoutIntervalId = null;

      let hrPhase = 0;

      let accPhase = 0;

      let elapsedTime = 0;



      const BASE_INTERVAL_MS = 1000;

      // Cache for exercise lookups to improve performance
      const exerciseCache = new Map();
      function getExerciseById(exerciseId) {
        if (exerciseCache.has(exerciseId)) {
          return exerciseCache.get(exerciseId);
        }
        const exercise = Object.values(exercises)
          .flatMap(group => Object.entries(group.exercises))
          .find(([id]) => id === exerciseId)?.[1];
        if (exercise) {
          exerciseCache.set(exerciseId, exercise);
        }
        return exercise;
      }

      // Pre-populate cache on initialization
      Object.values(exercises).forEach(group => {
        Object.entries(group.exercises).forEach(([id, exercise]) => {
          exerciseCache.set(id, exercise);
        });
      });

      // Data generation for active workout

      function generateExerciseData(exerciseId, intensity) {

        const exercise = getExerciseById(exerciseId);

        

        if (!exercise) return { hr: 0, acc: 0 };

        

        const multiplier = getIntensityMultiplier(exercise.type, intensity);

        let baseHr = exercise.baseHR * multiplier.hr;

        let baseAcc = exercise.baseAcc * multiplier.acc;

        

        // Add realistic variation

        baseHr += (Math.random() - 0.5) * 15;

        baseAcc += (Math.random() - 0.5) * 0.3;

        

        // Add some phase-based variation for realism

        baseHr += 10 * Math.sin(hrPhase);

        baseAcc += 0.2 * Math.sin(accPhase);

        

        hrPhase += 0.1;

        accPhase += 0.15;

        

        return {

          hr: clamp(baseHr, 60, 190),

          acc: clamp(baseAcc, 0, 4)

        };

      }



      function processWorkoutTick() {

        if (!state.currentSession) return;

        

        elapsedTime++;

        

        // Determine current exercise based on cumulative exercise durations
        // Exercises have different durations: strength ~2 min, cardio ~5 min, isometric ~1.5 min, mixed ~3.5 min

        let exerciseStartTime = 0;

        let exerciseIndex = 0;

        let currentExercise = null;

        

        for (let i = 0; i < state.currentSession.exercises.length; i++) {

          const exercise = state.currentSession.exercises[i];

          const exerciseDuration = (exercise.durationSeconds || getDefaultDuration(exercise.type));

          if (elapsedTime < exerciseStartTime + exerciseDuration) {

            exerciseIndex = i;

            currentExercise = exercise;

            break;

          }

          exerciseStartTime += exerciseDuration;

        }

        

        // If we've completed all exercises, use the last one

        if (!currentExercise) {

          exerciseIndex = state.currentSession.exercises.length - 1;

          currentExercise = state.currentSession.exercises[exerciseIndex];

        }

        
        // Store current exercise info for display
        state.currentSession.currentExerciseIndex = exerciseIndex;
        state.currentSession.currentExerciseName = currentExercise.name;

        const { hr, acc } = generateExerciseData(currentExercise.id, currentExercise.intensity);

        

        const effortInstant = computeEffort(hr, acc, currentExercise.type);

        

        const newPoint = {

          timestamp: new Date(),

          hr,

          acc,

          exercise: currentExercise.name,

          effortInstant,

          effortEma: effortInstant // Simplified for demo

        };

        

        activeWorkoutData.push(newPoint);

        

        // Update session metrics

        state.currentSession.currentHeartRate = hr;

        state.currentSession.currentMovement = acc;

        state.currentSession.currentEffort = effortInstant;

        state.currentSession.elapsedTime = elapsedTime;

        state.currentSession.calories += (0.06 * hr + 0.5 * acc) / 60;

        

        // Accumulate total effort (effort integrated over time)

        state.currentSession.totalEffort += effortInstant / 60;

        

        // Track hard seconds (effort >= 60)

        if (effortInstant >= 60) {

          state.currentSession.hardSeconds = (state.currentSession.hardSeconds || 0) + 1;

        }

        

        // Throttle rendering during active workout to improve performance
        // Only render once per animation frame (max 60fps)
        if (!state.currentSession._renderPending) {
          state.currentSession._renderPending = true;
          requestAnimationFrame(() => {
            renderApp();
            state.currentSession._renderPending = false;
          });
        }

      }



      // Workout management functions

      function startNewWorkout() {

        state.currentView = 'logWorkout';

        state.selectedExercises = [];

        renderApp();

      }



      function selectExercise(category, exerciseId) {

        const exercise = exercises[category].exercises[exerciseId];

        const existingIndex = state.selectedExercises.findIndex(e => e.id === exerciseId);

        

        if (existingIndex >= 0) {

          state.selectedExercises.splice(existingIndex, 1);

        } else {

          state.selectedExercises.push({

            id: exerciseId,

            name: exercise.name,

            category: category,

            type: exercise.type,

            intensity: getDefaultIntensity(exercise.type),

            duration: getDefaultDuration(exercise.type) / 60 // Convert seconds to minutes for display

          });

        }

        renderApp();

      }



      function setExerciseIntensity(exerciseId, intensity) {

        const exercise = state.selectedExercises.find(e => e.id === exerciseId);

        if (exercise) {

          exercise.intensity = intensity;

        }

        renderApp();

      }



      function startWorkoutSession() {

        if (state.selectedExercises.length === 0) {

          alert("Please add at least one exercise to your workout!");

          return;

        }

        

        // Convert duration from minutes to seconds and store for each exercise

        const exercisesWithDurations = state.selectedExercises.map(ex => ({

          ...ex,

          durationSeconds: (ex.duration || getDefaultDuration(ex.type) / 60) * 60

        }));

        

        state.currentSession = {

          id: Date.now(),

          date: new Date(),

          exercises: exercisesWithDurations,

          totalEffort: 0,

          totalCalories: 0,

          totalTime: 0,

          hardSeconds: 0,

          hardMinutes: 0,

          currentHeartRate: 0,

          currentMovement: 0,

          currentEffort: 0,

          elapsedTime: 0,

          calories: 0

        };

        

        activeWorkoutData = [];

        elapsedTime = 0;

        state.currentView = 'activeWorkout';

        

        workoutIntervalId = setInterval(processWorkoutTick, BASE_INTERVAL_MS);

        renderApp();

      }



      function completeWorkout() {

        if (state.currentSession) {

          // Calculate final metrics
          // totalEffort is already accumulated (effort integrated over time)

          state.currentSession.totalCalories = state.currentSession.calories;

          state.currentSession.totalTime = elapsedTime;

          // Calculate hard minutes from hard seconds

          state.currentSession.hardMinutes = (state.currentSession.hardSeconds || 0) / 60;

          

          state.workoutSessions.unshift(state.currentSession);

          state.currentSession = null;

        }

        

        if (workoutIntervalId) {

          clearInterval(workoutIntervalId);

          workoutIntervalId = null;

        }

        

        state.currentView = 'dashboard';

        renderApp();

      }



      function loadWorkoutTemplate(templateId) {

        const template = workoutTemplates[templateId];

        state.selectedExercises = template.exercises.map(exerciseId => {

          // Find exercise details using cached lookup

          const exercise = getExerciseById(exerciseId);

          

          if (!exercise) return null;
          
          // Find category efficiently
          let category = null;
          for (const cat of Object.keys(exercises)) {
            if (exercises[cat].exercises[exerciseId]) {
              category = cat;
              break;
            }
          }
          
          return {
            id: exerciseId,
            name: exercise.name,
            category: category,
            type: exercise.type,
            intensity: getDefaultIntensity(exercise.type),
            duration: getDefaultDuration(exercise.type) / 60
          };

        }).filter(Boolean);

        

        renderApp();

      }



      // Main rendering function

      function renderApp() {

        const root = document.getElementById('root');

        

        switch (state.currentView) {

          case 'dashboard':

            renderDashboard(root);

            break;

          case 'logWorkout':

            renderLogWorkout(root);

            break;

          case 'activeWorkout':

            renderActiveWorkout(root);

            break;

        }

      }



      function renderDashboard(root) {

        const recentSessions = state.workoutSessions.slice(0, 5);

        // Calculate average total effort across all sessions
        const totalEffort = state.workoutSessions.length > 0 
          ? state.workoutSessions.reduce((sum, session) => sum + (session.totalEffort || 0), 0) / state.workoutSessions.length 
          : 0;

        const effortLevel = getEffortLevel(totalEffort);

        

        root.innerHTML = `

          <div class="min-h-screen p-4 md:p-6">

            <header class="text-center mb-8">

              <h1 class="text-3xl font-bold text-white mb-2">Smart Workout Tracker</h1>

              <p class="text-slate-400">Track your effort, not just your reps</p>

            </header>

            

            <!-- Health Notice -->

            <div class="glass rounded-3xl p-4 mb-6 bg-purple-500-20 border border-purple-500">

              <p class="text-sm text-purple-400 text-center">

                üí° Remember: Every effort level is an achievement. Listen to your body and celebrate all activity!

              </p>

            </div>

            

            <!-- Rest Period Notice -->

            <div class="glass rounded-3xl p-4 mb-6 bg-sky-500-20 border border-sky-500">

              <p class="text-sm text-sky-400 text-center">

                ‚è±Ô∏è Rest periods are implied between exercises but are not tracked. Only active work time is counted for effort scoring.

              </p>

            </div>

            

            <!-- Overview Stats -->

            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">

              <div class="glass rounded-3xl p-4 text-center">

                <div class="text-2xl font-bold text-white">${state.workoutSessions.length}</div>

                <div class="text-slate-400 text-sm">Workouts</div>

              </div>

              <div class="glass rounded-3xl p-4 text-center">

                <div class="text-2xl font-bold text-emerald-400">${totalEffort.toFixed(1)}</div>

                <div class="text-slate-400 text-sm">Avg Effort</div>

              </div>

              <div class="glass rounded-3xl p-4 text-center">

                <div class="text-2xl font-bold text-orange-400">${effortLevel.level}</div>

                <div class="text-slate-400 text-sm">Level</div>

              </div>

            </div>

            

            <!-- Quick Start -->

            <div class="glass rounded-3xl p-6 mb-6">

              <h2 class="text-xl font-semibold text-white mb-4">Quick Start</h2>

              <button class="primary w-full py-4 mb-4" onclick="app.startNewWorkout()">

                üèãÔ∏è Start New Workout

              </button>

              

              <div class="grid grid-cols-2 gap-3">

                ${Object.entries(workoutTemplates).map(([id, template]) => `

                  <button class="py-3 text-sm" onclick="app.loadWorkoutTemplate('${id}')">

                    ${template.name}

                  </button>

                `).join('')}

              </div>

            </div>

            

            <!-- Recent Workouts -->

            <div class="glass rounded-3xl p-6">

              <h2 class="text-xl font-semibold text-white mb-4">Recent Workouts</h2>

              ${recentSessions.length > 0 ? `

                <div class="space-y-3">

                  ${recentSessions.map(session => {

                    const effort = getEffortLevel(session.totalEffort || 0);

                    return `

                      <div class="workout-session">

                        <div class="flex justify-between items-start mb-2">

                          <div>

                            <div class="font-semibold text-white">${session.exercises.map(e => e.name).join(', ')}</div>

                            <div class="text-slate-400 text-sm">${session.date.toLocaleDateString()} ‚Ä¢ ${formatDuration(session.totalTime || 0)}</div>

                          </div>

                          <span class="effort-badge ${effort.color}">${(session.totalEffort || 0).toFixed(1)}</span>

                        </div>

                        <div class="text-sm text-slate-400">${(session.totalCalories || 0).toFixed(0)} calories ‚Ä¢ ${effort.level} Effort${session.hardMinutes ? ` ‚Ä¢ ${session.hardMinutes.toFixed(1)} min hard` : ''}</div>

                      </div>

                    `;

                  }).join('')}

                </div>

              ` : `

                <p class="text-slate-400 text-center py-4">No workouts yet. Start your first one!</p>

              `}

            </div>

            

            <!-- Effort Guide -->

            <div class="glass rounded-3xl p-6 mt-6">

              <h2 class="text-xl font-semibold text-white mb-4">Understanding Effort Scores</h2>

              <div class="space-y-3">

                <div class="flex items-center gap-3">

                  <span class="effort-badge effort-low">0-29</span>

                  <div>

                    <div class="text-white text-sm">Low Effort</div>

                    <div class="text-slate-400 text-xs">Perfect for recovery, beginners, or active rest days</div>

                  </div>

                </div>

                <div class="flex items-center gap-3">

                  <span class="effort-badge effort-medium">30-59</span>

                  <div>

                    <div class="text-white text-sm">Medium Effort</div>

                    <div class="text-slate-400 text-xs">Ideal for consistent training and fitness maintenance</div>

                  </div>

                </div>

                <div class="flex items-center gap-3">

                  <span class="effort-badge effort-high">60-100</span>

                  <div>

                    <div class="text-white text-sm">High Effort</div>

                    <div class="text-slate-400 text-xs">Great for pushing limits - listen to your body's signals</div>

                  </div>

                </div>

              </div>

            </div>

          </div>

        `;

      }



      function renderLogWorkout(root) {

        root.innerHTML = `

          <div class="min-h-screen p-4 md:p-6">

            <header class="flex items-center justify-between mb-6">

              <div>

                <h1 class="text-2xl font-bold text-white">Log Workout</h1>

                <p class="text-slate-400">Select exercises and set intensity by proximity to failure</p>

              </div>

              <button onclick="app.setState({ currentView: 'dashboard' })" class="px-4 py-2">

                ‚Üê Back

              </button>

            </header>

            

            <!-- Rest Period Notice -->

            <div class="glass rounded-3xl p-4 mb-6 bg-sky-500-20 border border-sky-500">

              <p class="text-sm text-sky-400 text-center">

                ‚è±Ô∏è Rest periods between exercises are implied but not tracked. Only active work time is counted for effort scoring.

              </p>

            </div>

            

            <!-- Selected Exercises -->

            ${state.selectedExercises.length > 0 ? `

              <div class="glass rounded-3xl p-6 mb-6">

                <h2 class="text-xl font-semibold text-white mb-4">Selected Exercises (${state.selectedExercises.length})</h2>

                <div class="space-y-3">

                  ${state.selectedExercises.map(exercise => `

                    <div class="flex items-center justify-between p-3 bg-slate-800-50 rounded-2xl">

                      <div>

                        <div class="font-semibold text-white">${exercise.name}</div>

                        <div class="text-slate-400 text-sm">${exercise.duration.toFixed(1)} min work ‚Ä¢ ${getIntensityMultiplier(exercise.type, exercise.intensity).label}</div>

                      </div>

                      <div class="flex gap-2">

                        <select onchange="app.setExerciseIntensity('${exercise.id}', this.value)" 

                                class="bg-slate-700 rounded-lg px-2 py-1 text-sm">

                          ${exercise.type === 'strength' ? `
                            <option value="4RepsFromFailure" ${exercise.intensity === '4RepsFromFailure' ? 'selected' : ''}>4 Reps From Failure</option>
                            <option value="2RepsFromFailure" ${exercise.intensity === '2RepsFromFailure' ? 'selected' : ''}>2 Reps From Failure</option>
                            <option value="toFailure" ${exercise.intensity === 'toFailure' ? 'selected' : ''}>To Failure</option>
                          ` : exercise.type === 'isometric' ? `
                            <option value="steadyHold" ${exercise.intensity === 'steadyHold' ? 'selected' : ''}>Steady Hold</option>
                            <option value="challengingHold" ${exercise.intensity === 'challengingHold' ? 'selected' : ''}>Challenging Hold</option>
                            <option value="maxEffortHold" ${exercise.intensity === 'maxEffortHold' ? 'selected' : ''}>Max Effort Hold</option>
                          ` : `
                            <option value="easy" ${exercise.intensity === 'easy' ? 'selected' : ''}>Easy</option>
                            <option value="moderate" ${exercise.intensity === 'moderate' ? 'selected' : ''}>Moderate</option>
                            <option value="hard" ${exercise.intensity === 'hard' ? 'selected' : ''}>Hard</option>
                          `}

                        </select>

                        <button onclick="app.selectExercise('${exercise.category}', '${exercise.id}')" 

                                class="px-3 py-1 bg-slate-700 rounded-lg text-sm">

                          Remove

                        </button>

                      </div>

                    </div>

                  `).join('')}

                </div>

                <button class="primary w-full mt-4 py-4" onclick="app.startWorkoutSession()">

                  Start Workout

                </button>

              </div>

            ` : ''}

            

            <!-- Exercise Library -->

            <div class="glass rounded-3xl p-6">

              <h2 class="text-xl font-semibold text-white mb-4">Exercise Library</h2>

              <div class="space-y-6">

                ${Object.entries(exercises).map(([category, group]) => `

                  <div>

                    <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">

                      <span>${group.icon}</span>

                      ${group.name}

                    </h3>

                    <div class="exercise-group">

                      ${Object.entries(group.exercises).map(([id, exercise]) => {

                        const isSelected = state.selectedExercises.some(e => e.id === id);

                        return `

                          <div class="exercise-item ${isSelected ? 'selected' : ''}" 

                               onclick="app.selectExercise('${category}', '${id}')">

                            <div class="font-medium text-white">${exercise.name}</div>

                            <div class="text-slate-400 text-sm">${exercise.type} ‚Ä¢ Base HR: ${exercise.baseHR}</div>

                          </div>

                        `;

                      }).join('')}

                    </div>

                  </div>

                `).join('')}

              </div>

            </div>

          </div>

        `;

      }



      function renderActiveWorkout(root) {

        if (!state.currentSession) return;

        

        const currentEffortLevel = getEffortLevel(state.currentSession.currentEffort);

        // Calculate progress based on cumulative exercise durations
        const totalDuration = state.currentSession.exercises.reduce((sum, ex) => 
          sum + (ex.durationSeconds || getDefaultDuration(ex.type)), 0);
        const progress = Math.min((state.currentSession.elapsedTime / totalDuration) * 100, 100);

        const currentExercise = state.currentSession.exercises[state.currentSession.currentExerciseIndex || 0];

        const intensityLabel = currentExercise ? getIntensityMultiplier(currentExercise.type, currentExercise.intensity).label : 'Moderate';

        

        root.innerHTML = `

          <div class="min-h-screen p-4 md:p-6">

            <header class="flex justify-between items-center mb-6">

              <div>

                <h1 class="text-2xl font-bold text-white">Active Workout</h1>

                <p class="text-slate-400">${formatDuration(state.currentSession.elapsedTime)} work time (rest periods not tracked)</p>

              </div>

              <button onclick="app.completeWorkout()" class="px-4 py-2 bg-emerald-500 text-white">

                Complete

              </button>

            </header>

            

            <!-- Current Exercise -->

            <div class="glass rounded-3xl p-6 mb-6 bg-sky-500-20 border border-sky-500">

              <div class="text-center">

                <div class="text-sm text-slate-400 mb-2">Current Exercise</div>

                <div class="text-3xl font-bold text-white mb-2">${currentExercise?.name || 'Preparing...'}</div>

                <div class="text-slate-300">${intensityLabel}</div>

              </div>

            </div>

            

            <!-- Progress -->

            <div class="glass rounded-3xl p-6 mb-6">

              <div class="flex justify-between items-center mb-3">

                <span class="text-slate-400">Work Progress (Active Work Only)</span>

                <span class="text-white font-semibold">${Math.round(progress)}%</span>

              </div>

              <div class="progress-bar">

                <div class="progress-fill" style="width: ${progress}%"></div>

              </div>

              <div class="text-xs text-slate-500 mt-2 text-center">Rest periods are implied but not included in tracking</div>

            </div>

            

            <!-- Live Metrics -->

            <div class="grid grid-cols-2 gap-4 mb-6">

              <div class="glass rounded-3xl p-6 text-center">

                <div class="text-3xl font-bold text-emerald-400 mb-2">${state.currentSession.currentEffort.toFixed(1)}</div>

                <div class="text-slate-400">Effort Score</div>

                <div class="text-sm mt-1 ${currentEffortLevel.color}">${currentEffortLevel.level}</div>

              </div>

              <div class="glass rounded-3xl p-6 text-center">

                <div class="text-3xl font-bold text-orange-400 mb-2">${state.currentSession.calories.toFixed(0)}</div>

                <div class="text-slate-400">Calories</div>

              </div>

            </div>

            

            <!-- Current Stats -->

            <div class="glass rounded-3xl p-6 mb-6">

              <h2 class="text-xl font-semibold text-white mb-4">Live Data</h2>

              <div class="grid grid-cols-2 gap-4">

                <div class="text-center">

                  <div class="text-2xl font-bold text-sky-400">${state.currentSession.currentHeartRate.toFixed(0)}</div>

                  <div class="text-slate-400 text-sm">Heart Rate</div>

                </div>

                <div class="text-center">

                  <div class="text-2xl font-bold text-orange-400">${state.currentSession.currentMovement.toFixed(2)}</div>

                  <div class="text-slate-400 text-sm">Movement</div>

                </div>

              </div>

            </div>

            

            <!-- Exercise List -->

            <div class="glass rounded-3xl p-6">

              <h2 class="text-xl font-semibold text-white mb-4">Workout Plan</h2>

              <div class="space-y-3">

                ${state.currentSession.exercises.map((exercise, index) => {

                  const currentIndex = state.currentSession.currentExerciseIndex ?? 0;

                  const intensityLabel = getIntensityMultiplier(exercise.type, exercise.intensity).label;

                  return `

                    <div class="flex items-center justify-between p-3 bg-slate-800-50 rounded-2xl ${index === currentIndex ? 'border border-emerald-500' : ''}">

                      <div class="flex items-center gap-3">

                        <div class="w-3 h-3 rounded-full ${index === currentIndex ? 'bg-emerald-500 kpi-pulse' : 'bg-slate-600'}"></div>

                        <div>

                          <div class="font-semibold text-white ${index === currentIndex ? 'text-emerald-400' : ''}">${exercise.name}</div>

                          <div class="text-slate-400 text-sm">${intensityLabel}</div>

                        </div>

                      </div>

                      <span class="text-slate-400">${(exercise.durationSeconds || getDefaultDuration(exercise.type)) / 60} min work</span>

                    </div>

                  `;

                }).join('')}

              </div>

            </div>

          </div>

        `;

      }



      // Expose functions globally

      window.app = {

        startNewWorkout,

        selectExercise,

        setExerciseIntensity,

        startWorkoutSession,

        completeWorkout,

        loadWorkoutTemplate,

        setState: (newState) => Object.assign(state, newState)

      };



      // Initial render

      renderApp();

    }



    // Start the application immediately
    // Use DOMContentLoaded or immediate execution for faster loading
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      // DOM already loaded, execute immediately
      initializeApp();
    }

  </script>

</body>

</html>